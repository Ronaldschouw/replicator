---
version: '3'
services:
  grafana:
    image: "grafana/grafana:${GRAFANA_VERSION}"
    expose:
     - 3000
    environment:
      GF_PATHS_DATA : /var/lib/grafana
      GF_SECURITY_ADMIN_PASSWORD : kafka
      GF_INSTALL_PLUGINS: grafana-strava-datasource
      GF_FEATURE_TOGGLES_ENABLE: externalServiceAccounts
    volumes:
     - ./grafana/provisioning:/etc/grafana/provisioning
     - ./grafana/dashboards:/var/lib/grafana/dashboards
    restart: always
    networks:
      - strava
    container_name: grafana
#
  strava_nginx:
    image: ronaldschouw/nginx
    container_name: strava_nginx
    ports:
      - 8888:8888
    volumes:
      - ./nginx/app.conf:/etc/nginx/conf.d/default.conf:cached
    restart: always
    networks:
      - strava
    deploy:
      resources:
        limits:
          cpus: '0.15'
          memory: 64M
        reservations:
          cpus: '0.10'
          memory: 32M


networks:
  strava:
    external: true

